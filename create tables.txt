CREATE TABLE BOOK
(
  BOOK_ID			BIGINT  NOT NULL ,
  ISBN			VARCHAR(20)  NOT NULL,		
  PRICE			REAL         NOT NULL ,
  PUBLISHER			NVARCHAR(40) NOT NULL ,
  PUBLICATION_YEAR	INT NOT NULL ,
  CATEGORY			NVARCHAR(30)  NOT NULL ,
  AUTHOR			NVARCHAR(30)	 NOT NULL ,
  TITLE			NVARCHAR(75) NOT NULL ,
  PAGES			INT	 NOT NULL ,
  DESCRIPTION_FIELD	NVARCHAR(MAX),
  RANKING			INT	  DEFAULT '0',
  HARD_COVER		BIT NOT NULL DEFAULT '0',
  COVER			VARCHAR(40) NOT NULL,
  AVAILABILITY		INT NOT NULL,
  PRIMARY KEY (BOOK_ID),
  UNIQUE(ISBN),	
  CHECK (RANKING >=1 AND RANKING <=5)
);


CREATE TABLE CUSTOMER 
(
  CUSTOMER_ID  		INT  NOT NULL,
  NAME   			NVARCHAR(15) DEFAULT '',
  SURNAME   		NVARCHAR(15) DEFAULT '',
  NICKNAME  		NVARCHAR(40) NOT NULL,  
  PASSWD  			NVARCHAR(20) NOT NULL, 
  EMAIL   			NVARCHAR(40) NOT NULL,  
  REVIEWS_NUMBER 		INTEGER     DEFAULT '',
  TELEPHONE_NUMBER  	VARCHAR(25)          NOT NULL,
  BIRTHDAY_DATE  		DATE,
  PRIMARY KEY (CUSTOMER_ID),
  UNIQUE(EMAIL)
);


CREATE TABLE REVIEW
(
  REVIEW_ID 		INT NOT NULL ,
  RATE 			INT NOT NULL,  
  COMMENTS 			VARCHAR(MAX) ,
  CUSTOMER_ID 		INT,
  BOOK_ID	 		BIGINT,
  PRIMARY KEY (REVIEW_ID) ,
  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER ,
  FOREIGN KEY (BOOK_ID) REFERENCES BOOK ,
  CHECK (RATE >=1 AND RATE <= 5)
);





CREATE TABLE CART
(
  CART_ID       		INT    NOT NULL ,
  CUSTOMER_ID    		INT     NOT NULL ,
  COMPLETED       	BIT   DEFAULT '0'   NOT NULL ,
  PRIMARY KEY (CART_ID),
  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER 
  ON DELETE CASCADE
);


CREATE TABLE ORDERS
(
  ORDER_ID   			BIGINT   NOT NULL,
  CART_ID   			INT     NOT NULL ,
  PAYMENT_WAY     		NVARCHAR(20)       NOT NULL,
  ORDER_DATE   			DATE          NOT NULL ,
  DELIVERY_PLACE_COUNTRY      NVARCHAR(15) DEFAULT 'GREECE' ,
  DELIVERY_PLACE_CITY  		NVARCHAR(15) DEFAULT 'ATHENS' ,
  DELIVERY_PLACE_STREET  	NVARCHAR(30)     NOT NULL ,
  DELIVERY_PLACE_NUMBER  	INT        NOT NULL ,
  DELIVERY_PLACE_PC  		INT      NOT NULL , 
  PRIMARY KEY (ORDER_ID),
  FOREIGN KEY (CART_ID) REFERENCES CART	
  ON DELETE CASCADE,
  CHECK(PAYMENT_WAY = 'Cash' OR PAYMENT_WAY = 'American Express' OR PAYMENT_WAY = 'Maestro'
     OR PAYMENT_WAY = 'MasterCard' OR PAYMENT_WAY = 'Paypal' OR PAYMENT_WAY = 'Visa')
);



CREATE TABLE [CONTAINS] 
(
   CART_ID				INT		NOT NULL,
   BOOK_ID      			BIGINT           NOT NULL,
   QUANTITY	 			INT NOT NULL,
   PRIMARY KEY (CART_ID, BOOK_ID),
   FOREIGN KEY (CART_ID) REFERENCES CART 
ON DELETE CASCADE,
   FOREIGN KEY (BOOK_ID) REFERENCES BOOK 
ON DELETE CASCADE
);
